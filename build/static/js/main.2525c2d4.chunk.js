(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{188:function(e,t,s){},192:function(e,t,s){},193:function(e,t,s){},195:function(e,t,s){"use strict";s.r(t);var n=s(0),r=s.n(n),a=s(73),o=s.n(a),c=(s(84),s(9)),i=s(2),d=s(3),m=s(7),l=s(8),u=(s(85),s(86),s(1)),b=function(){return Object(u.jsx)("div",{className:"header",children:Object(u.jsx)("h1",{children:"Chat App"})})},p=s(10),h=s(196),j=s(18),g=(s(188),function(e){var t=j.a().shape({username:j.b().required("Provide a Username"),password:j.b().required("Provide a Password")});return Object(u.jsx)("div",{className:"login",children:Object(u.jsx)(p.c,{initialValues:{username:"",password:""},validationSchema:t,onSubmit:function(t,s){var n=s.setSubmitting;console.log("here");var r=new XMLHttpRequest,a=new FormData;a.append("username",t.username),a.append("password",t.password),r.open("POST",e.serverUrl+"/login"),r.onreadystatechange=function(){if(4===this.readyState){if(201===this.status){var s=JSON.parse(this.responseText);console.log(s.message_token),console.log(s.stream_token),e.setTokken(s.message_token),e.setTokkenStream(s.stream_token),e.setLogin(!0)}else 403===this.status?alert("Invalid username or password"):409===this.status?alert(t.username+" is already logged in"):alert(this.status+" failure to /login");n(!1)}},r.send(a)},children:function(e){var t=e.handleSubmit,s=e.isSubmitting,n=e.touched,r=e.errors;return Object(u.jsxs)(h.a,{onSubmit:t,children:[Object(u.jsxs)("div",{className:"form-group padding",children:[Object(u.jsx)("div",{className:"form-text text-muted",children:"Username"}),Object(u.jsx)(p.b,{type:"username",name:"username",placeholder:"Username",className:"form-control ".concat(n.username&&r.username?"is-invalid":"")}),Object(u.jsx)(p.a,{name:"username",component:"div",className:"invalid-feedback"})]}),Object(u.jsxs)("div",{className:"form-group padding",children:[Object(u.jsx)("div",{className:"form-text text-muted",children:"Password"}),Object(u.jsx)(p.b,{type:"password",name:"password",placeholder:"Enter password",className:"form-control ".concat(n.password&&r.password?"is-invalid":"")}),Object(u.jsx)(p.a,{name:"password",component:"div",className:"invalid-feedback"})]}),Object(u.jsx)("div",{className:"padding",children:Object(u.jsx)("button",{type:"submit",disabled:s,className:"btn btn-primary",children:"Login"})})]})}})})}),k=(s(192),function(e){var t=j.a().shape({message:j.b().required("Type a message first")});return Object(u.jsx)("div",{className:"textmain",children:Object(u.jsx)(p.c,{initialValues:{message:""},validationSchema:t,onSubmit:function(t,s){var n=s.setSubmitting;console.log("here");var r=new FormData;r.append("message",t.message);var a=new XMLHttpRequest;a.open("POST",e.serverUrl+"/message"),a.setRequestHeader("Authorization","Bearer "+e.tokken),a.onreadystatechange=function(t){4===t.target.readyState&&403!==t.target.status&&null!==e.tokken&&e.setTokken(t.target.getResponseHeader("token")),n(!1)},a.send(r)},children:function(t){var s=t.handleSubmit,n=t.isSubmitting,r=(t.touched,t.errors);return Object(u.jsxs)(h.a,{onSubmit:s,children:[Object(u.jsxs)("div",{className:"form-group textbar",children:[Object(u.jsx)(p.b,{type:"message",name:"message",placeholder:e.Testbox?"You are Disconnected":"Type your message here",disabled:e.Textbox,className:"form-control ".concat(r.message?"is-invalid":"")}),Object(u.jsx)(p.a,{name:"message",component:"div",className:"invalid-feedback"})]}),Object(u.jsx)("div",{className:"sendButton",children:Object(u.jsx)("button",{type:"submit",disabled:n,className:"btn btn-primary",children:"Send"})})]})}})})}),v=function(e){Object(m.a)(s,e);var t=Object(l.a)(s);function s(e){var n;return Object(i.a)(this,s),(n=t.call(this,e)).chatContainer=r.a.createRef(),n.date_format=function(e){var t=new Date(1e3*e);return t.toLocaleDateString("en-US")+" "+t.toLocaleTimeString("en-US")},n.renderArray=function(e){return e.map((function(e){return Object(u.jsx)("p",{children:e})}))},n.connect=function(){n.setState({textbox:!0},(function(){console.log("connected")}))},n.disconnect=function(e){n.setState({textbox:!0},(function(){e&&n.props.setLogin(!1)}))},n.start_stream=function(e){console.log(n.props),e.addEventListener("open",(function(e){n.connect()}),!1),e.addEventListener("Disconnect",(function(t){e.close(),n.props.setTokken(""),n.props.setTokkenServer(""),n.disconnect(!0)}),!1),e.addEventListener("Join",(function(e){var t=JSON.parse(e.data);n.props.addMember(t.user),n.props.addMessage(n.date_format(t.created)+" JOIN: "+t.user),n.scrollToMyRef()}),!1),e.addEventListener("Message",(function(e){var t=JSON.parse(e.data);console.log(n.props),n.props.addMessage(n.date_format(t.created)+" ("+t.user+") "+t.message),n.scrollToMyRef()}),!1),e.addEventListener("Part",(function(e){var t=JSON.parse(e.data);n.props.removeMember(t.user),n.props.addMessage(n.date_format(t.created)+" PART: "+t.user),n.scrollToMyRef()}),!1),e.addEventListener("ServerStatus",(function(e){var t=JSON.parse(e.data);n.props.addMessage(n.date_format(t.created)+" STATUS: "+t.status),n.scrollToMyRef()}),!1),e.addEventListener("Users",(function(e){var t=JSON.parse(e.data);console.log(t.users),n.props.addMembers(t.users),n.scrollToMyRef()}),!1),e.addEventListener("error",(function(e){2===e.target.readyState?(n.props.setTokken(""),n.props.setTokkenStream(""),n.disconnect(!0)):n.disconnect(!1)}),!1)},n.scrollToMyRef=function(){var e=n.chatContainer.current.scrollHeight-n.chatContainer.current.clientHeight;n.chatContainer.current.scrollTo(0,e)},n.state={textbox:!0},n}return Object(d.a)(s,[{key:"componentDidMount",value:function(){var e=new EventSource(this.props.serverUrl+"/stream/"+this.props.tokkenStream);this.start_stream(e)}},{key:"render",value:function(){return Object(u.jsxs)("div",{className:"chatmain",children:[Object(u.jsxs)("div",{ref:this.chatContainer,className:"messagebox",children:[Object(u.jsxs)("div",{className:"messages",children:[Object(u.jsx)("h3",{children:" Messages "}),this.renderArray(this.props.messages)]}),Object(u.jsx)("div",{className:"textboxplaceholder"}),Object(u.jsx)("div",{className:"textbox",children:Object(u.jsx)(k,{textbox:this.state.textbox,tokken:this.props.tokken,setTokken:this.props.setTokken,serverUrl:this.props.serverUrl})})]}),Object(u.jsxs)("div",{className:"members",children:[Object(u.jsx)("h3",{children:" Members "}),this.renderArray(this.props.members)]})]})}}]),s}(n.Component),f=function(e){return Object(u.jsx)("div",{children:e.login?Object(u.jsx)(v,{addMessage:e.addMessage,addMember:e.addMember,removeMember:e.removeMember,setLogin:e.setLogin,setTokken:e.setTokken,setTokkenStream:e.setTokkenStream,serverUrl:e.serverUrl,messages:e.messages,members:e.members,tokken:e.tokken,tokkenStream:e.tokkenStream,addMembers:e.addMembers}):Object(u.jsx)(g,{setTokken:e.setTokken,setTokkenStream:e.setTokkenStream,setLogin:e.setLogin,serverUrl:e.serverUrl})})},x=(s(193),function(){return Object(u.jsx)("div",{className:"footer",children:Object(u.jsx)("p",{className:"footerText",children:"Chat app for CS291a by Punnal and Shereen"})})}),O=function(e){Object(m.a)(s,e);var t=Object(l.a)(s);function s(){var e;return Object(i.a)(this,s),(e=t.call(this)).setTokken=function(t){e.setState({tokken:t})},e.setTokkenStream=function(t){e.setState({tokkenStream:t})},e.setLogin=function(t){e.setState({loggedIn:t})},e.addMembers=function(t){e.setState({members:t})},e.addMessage=function(t){e.setState((function(e){return{messages:[].concat(Object(c.a)(e.messages),[t])}}))},e.addMember=function(t){e.state.members.includes(t)||e.setState((function(e){return{members:[].concat(Object(c.a)(e.members),[t])}}))},e.removeMember=function(t){e.setState((function(e){return{members:e.members.filter((function(e){return!(e===t)}))}}))},e.state={loggedIn:!1,tokken:"",tokkenStream:"",messages:[],members:[],serverUrl:"https://chat.cs291.com"},e}return Object(d.a)(s,[{key:"render",value:function(){return Object(u.jsxs)("div",{className:"App",children:[Object(u.jsx)(b,{}),Object(u.jsx)(f,{setTokken:this.setTokken,setTokkenStream:this.setTokkenStream,setLogin:this.setLogin,addMessage:this.addMessage,addMember:this.addMember,removeMember:this.removeMember,serverUrl:this.state.serverUrl,login:this.state.loggedIn,messages:this.state.messages,members:this.state.members,tokken:this.state.tokken,tokkenStream:this.state.tokkenStream,addMembers:this.addMembers}),Object(u.jsx)(x,{})]})}}]),s}(n.Component),S=function(e){e&&e instanceof Function&&s.e(3).then(s.bind(null,197)).then((function(t){var s=t.getCLS,n=t.getFID,r=t.getFCP,a=t.getLCP,o=t.getTTFB;s(e),n(e),r(e),a(e),o(e)}))};s(194);o.a.render(Object(u.jsx)(r.a.StrictMode,{children:Object(u.jsx)(O,{})}),document.getElementById("root")),S()},84:function(e,t,s){},85:function(e,t,s){},86:function(e,t,s){}},[[195,1,2]]]);
//# sourceMappingURL=main.2525c2d4.chunk.js.map